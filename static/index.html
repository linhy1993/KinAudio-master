<html lang="fr-FR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>KinVideo | radio-canada</title>
  <meta content="action-uri=http://ici.radio-canada.ca/favicon.ico" name="msapplication-task">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/kinvideo.css">
  <link rel="stylesheet" href="css/animate.css">
</head>
<body>
<header id="masthead" class="col-sm-12">
  <img src="imgs/logo_reperes.gif">
</header>

<div id="content">
  <div class="input-group input-group-lg">
    <input type="text" id="search_input" class="form-control" aria-describedby="sizing-addon1">
    <div class="input-group-btn">
      <button class="btn btn-default" type="button" style="outline: none;" id="voice_btn"><i class="fa fa-microphone"></i></button>
      <button class="btn btn-default" type="button" style="outline: none;" id="search_btn">Go!</button>
    </div>
  </div>

  <div class="com-sm-12" id="search_results">

    <!--<div id="no_0" class="col-sm-12 well well-no-bottom">-->
      <!--<div class="col-sm-2" style="text-align: center">-->
        <!--<img src="imgs/number_0.png" height="45px">-->
      <!--</div>-->
      <!--<div class="col-md-10">-->
        <!--<ul>-->
          <!--<li><b class="title">Le nombre de prescriptions d'antidépresseurs pour les enfants en hausse</b></li>-->
          <!--<li class="key-word-list">-->
            <!--<span>chercheurs ontariens</span>-->
            <!--<span>antidépresseurs</span>-->
            <!--<span>constante augmentation</span>-->
            <!--<span>Revue canadienne de psychiatrie</span>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</div>-->
    <!--</div>-->

    <!--<div id="no_1" class="col-sm-12 well well-no-bottom">-->
      <!--<div class="col-sm-2" style="text-align: center">-->
        <!--<img src="imgs/number_1.png" height="45px">-->
      <!--</div>-->
      <!--<div class="col-md-10">-->
        <!--<ul>-->
          <!--<li><b class="title">Le nombre de prescriptions d'antidépresseurs pour les enfants en hausse</b></li>-->
          <!--<li>-->
            <!--<span>chercheurs ontariens</span>-->
            <!--<span>antidépresseurs</span>-->
            <!--<span>constante augmentation</span>-->
            <!--<span>Revue canadienne de psychiatrie</span>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</div>-->
    <!--</div>-->

    <!--<div id="no_2" class="col-sm-12 well well-no-bottom">-->
      <!--<div class="col-sm-2" style="text-align: center">-->
        <!--<img src="imgs/number_2.png" height="45">-->
      <!--</div>-->
      <!--<div class="col-md-10">-->
        <!--<ul>-->
          <!--<li><b class="title">Le nombre de prescriptions d'antidépresseurs pour les enfants en hausse</b></li>-->
          <!--<li>-->
            <!--<span>chercheurs ontariens,</span>-->
            <!--<span>antidépresseurs,</span>-->
            <!--<span>constante augmentation,</span>-->
            <!--<span>Revue canadienne de psychiatrie</span>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</div>-->
    <!--</div>-->

    <!--<div id="no_3" class="col-sm-12 well well-no-bottom">-->
      <!--<div class="col-sm-2" style="text-align: center">-->
        <!--<img src="imgs/number_3.png" height="45">-->
      <!--</div>-->
      <!--<div class="col-md-10">-->
        <!--<ul>-->
          <!--<li><b class="title">Le nombre de prescriptions d'antidépresseurs pour les enfants en hausse</b></li>-->
          <!--<li>-->
            <!--<span>chercheurs ontariens</span>-->
            <!--<span>antidépresseurs</span>-->
            <!--<span>constante augmentation</span>-->
            <!--<span>Revue canadienne de psychiatrie</span>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</div>-->
    <!--</div>-->

    <!--<div id="no_4" class="col-sm-12 well well-no-bottom">-->
      <!--<div class="col-sm-2" style="text-align: center">-->
        <!--<img src="imgs/number_4.png" height="45">-->
      <!--</div>-->
      <!--<div class="col-md-10">-->
        <!--<ul>-->
          <!--<li><b class="title">Le nombre de prescriptions d'antidépresseurs pour les enfants en hausse</b></li>-->
          <!--<li>-->
            <!--<span>chercheurs ontariens</span>-->
            <!--<span>antidépresseurs</span>-->
            <!--<span>constante augmentation</span>-->
            <!--<span>Revue canadienne de psychiatrie</span>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</div>-->
    <!--</div>-->

    <!--<div id="no_5" class="col-sm-12 well well-no-bottom">-->
      <!--<div class="col-sm-2" style="text-align: center">-->
        <!--<img src="imgs/number_5.png" height="45">-->
      <!--</div>-->
      <!--<div class="col-md-10">-->
        <!--<ul>-->
          <!--<li><b class="title">Le nombre de prescriptions d'antidépresseurs pour les enfants en hausse</b></li>-->
          <!--<li>-->
            <!--<span>chercheurs ontariens</span>-->
            <!--<span>antidépresseurs</span>-->
            <!--<span>constante augmentation</span>-->
            <!--<span>Revue canadienne de psychiatrie</span>-->
          <!--</li>-->
        <!--</ul>-->
      <!--</div>-->
    <!--</div>-->

  </div>
</div>

<footer id="pageFooter" class="col-sm-12">
  <div class="col-sm-4 col-sm-offset-4 wrap">
    <aside id="text-6">
      <h3 class="widget-title">Liens</h3>
      <div>
        <ul>
          <li><a href="http://reperes.ici.ca/faq/">FAQ</a></li>
          <li><a href="http://entraide.ici.radio-canada.ca/" target="_blank">Forum Entraide</a></li>
          <li><a href="http://presse.radio-canada.ca" target="_blank">Centre de presse</a></li>
          <li><a href="http://lab.radio-canada.ca/" target="_blank">RC Lab</a></li>
          <li><a href="http://www.cbc.radio-canada.ca/fr/rendre-des-comptes-aux-canadiens/sync/" target="_blank">SYNC: la revue technologique</a></li>
          <li><a href="http://www.cbc.radio-canada.ca/fr/rendre-des-comptes-aux-canadiens/normes-technologiques/" target="_blank">Normes techniques en haute définition</a></li>
        </ul>
      </div>
    </aside>
  </div>
  <div class="col-md-4 wrap">
    <aside><h3>Restez informé !</h3>
      <ul id="emailSub-widget" style="padding-bottom: 20px;">
        <div id="emailSub-output" style="display:none;"></div>
        <form id="emailSub-form" action="http://reperes.ici.ca/wp-admin/admin-ajax.php">
          <input type="hidden" name="success_msg" id="emailSub-success" value="Merci !">
          <input type="hidden" name="fail_msg" id="emailSub-fail" value="Une erreur est survenue, essayez plus tard.">
          <input type="text" name="email" id="emailSub-email" placeholder="Courriel:">
          <input type="submit" class="submit" value="Je m'abonne !">
        </form>
      </ul>
    </aside>
  </div>
  <div class="col-md-12 bottom"><p><strong>Tous droits réservés</strong><br>© Société Radio-Canada</p></div>
</footer>
<script src="js/jquery-1.11.3.min.js"></script>
<script>
    var voice_btn = $("#voice_btn");
    var voice_btn_i = voice_btn.find(".fa-microphone");
    var search_btn = $("#search_btn");
    var search_input = $("#search_input");

    $("document").ready(function () {
        voice_btn.on("mouseenter", function () {
            voice_btn_i.addClass("recording");
            search_input.val("voice is being recorded .....");
            startRecording();
        });

        voice_btn.on("mouseleave", function () {
            voice_btn_i.removeClass("recording");
            sendRecording();
        });

        search_btn.on("click", function () {
            var search_input_txt = search_input.val();
            var info = {};
            info["search_input"] = search_input_txt;

            $.ajax({
                type: "POST",
                url: "/api/search",
                data: JSON.stringify(info)
            }).done(function (data) {
                  update_search_results(data);
            }).fail(function () {
                  alert("[ERROR]Some issues in Internet");
            });
        });
    });
</script>


<script type="text/javascript" src="recorder.js"></script>
<script>
    var onFail = function (e) {
        console.log("Rejected!", e);
    };


    var onSuccess = function (s) {
        var Context = AudioContext || webkitAudioContext;
        var context = new Context();
        var mediaStreamSource = context.createMediaStreamSource(s);
        recorder = new Recorder(mediaStreamSource);
        recorder.record();
    };

    window.URL = window.URL || window.webkitURL;
    navigator.getUserMedia =
        navigator.getUserMedia ||
        navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia ||
        navigator.msGetUserMedia;

    var recorder;
    var audio = document.querySelector("audio");


    var startRecording = function () {
        if (navigator.getUserMedia) {
            navigator.getUserMedia({audio: true}, onSuccess, onFail);
        } else {
            alert("[ERROR]navigator.getUserMedia not present");
            console.log("navigator.getUserMedia not present");
        }
    };


    var sendRecording = function () {
        recorder.stop();
        recorder.exportWAV(function (s) {
            sendBlob2BK(s);
        });
        recorder.clear();
    };


    var sendBlob2BK = function (soundBlob) {
        var fd = new FormData();
        fd.append("blob_stream", soundBlob);
        $.ajax({
            type: "POST",
            url: "/api/speech_text",
            data: fd,
            cache: false,
            processData: false,
            contentType: false
        }).done(function (data) {
            if (data.code === 200) {
                search_input.val(data.data);
            } else {
                search_input.val("Voice is too clear to analyze");
            }
        }).fail(function () {
            alert("[ERROR]Some Issues on Internet");
        });
    };


    var update_search_results = function (data) {
        var search_results = $('#search_results');
        search_results.empty();
        var content = '';
        var news_list = data.data;

        for (var i = 0; i < news_list.length; i++) {

            console.log(news_list[i].id);
            console.log(news_list[i].sum);
            console.log(news_list[i].href);

            var news_id = 'no_' + i;
            var img_url = 'imgs/number_' + i + '.png';
            content += '<div id="' + news_id + '" class="col-sm-12 well well-no-bottom">\n' +
                '      <div class="col-sm-2" style="text-align: center">\n' +
                '        <img src="' + img_url + '" height="45px">\n' +
                '      </div>\n' +
                '      <div class="col-md-10">\n' +
                '        <ul>\n' +
                '          <li><b class="title">' + news_list[i].title + '</b></li>\n' +
                '          <li class="key-word-list">\n' +
                '            <span>' + news_list[i].sum[0] + '</span>\n' +
                '            <span>' + news_list[i].sum[1] + '</span>\n' +
                '            <span>' + news_list[i].sum[2] + '</span>\n' +
                '            <span>' + news_list[i].sum[3] + '</span>\n' +
                '          </li>\n' +
                '        </ul>\n' +
                '      </div>\n' +
                '    </div>';
        }

        search_results.append(content);

        for (var i = 0; i < news_list.length; i++) {
            var href = news_list[i].link;
            $('#no_' + i).addClass('animated fadeInDown');
            $('#no_' + i).click(function () {
                window.open(href);
            });


        }

    };
</script>
</body>
</html>
